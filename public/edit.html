<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
    
    * {
      font-family: 'Cairo', sans-serif;
    }
    
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
      z-index: -1;
    }
    
    #loginOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }
    
    #loginBox {
      background: rgba(255,255,255,0.95);
      padding: 40px;
      border-radius: 20px;
      width: 90%;
      max-width: 420px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      animation: slideIn 0.6s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .school-logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .school-logo i {
      font-size: 3rem;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .school-name {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 5px;
    }
    
    .school-motto {
      font-size: 0.9rem;
      color: #7f8c8d;
      font-style: italic;
    }
    
    .main-container {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      margin: 20px;
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .header-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 20px 20px 0 0;
      position: relative;
      overflow: hidden;
    }
    
    .header-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 4s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.3;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.1;
      }
    }
    
    .header-content {
      position: relative;
      z-index: 2;
    }
    
    .system-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .inspiration-quote {
      font-size: 1.1rem;
      opacity: 0.9;
      font-style: italic;
      margin-bottom: 20px;
    }
    
    .user-welcome {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }
    
    .editable {
      background: linear-gradient(135deg, #fff7e6 0%, #ffeaa7 100%);
      border: 2px solid #fdcb6e;
      border-radius: 8px;
      padding: 8px;
      transition: all 0.3s ease;
      width: 60px;
      text-align: center;
    }
    
    .editable:focus {
      outline: none;
      box-shadow: 0 0 15px rgba(253, 203, 110, 0.5);
      transform: scale(1.02);
    }
    
    .action-btn {
      margin-left: 5px;
      border-radius: 10px;
      padding: 8px 15px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .table-container {
      padding: 30px;
      background: rgba(255,255,255,0.8);
      border-radius: 15px;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .custom-table {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .custom-table thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .custom-table th {
      padding: 15px 8px;
      font-weight: 600;
      text-align: center;
      border: none;
      font-size: 0.9rem;
      min-width: 80px;
    }
    
    .custom-table td {
      padding: 10px 5px;
      text-align: center;
      border: none;
      background: rgba(255,255,255,0.8);
      transition: all 0.3s ease;
      font-size: 0.85rem;
    }
    
    .custom-table tbody tr:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: scale(1.01);
    }
    
    .add-student-section {
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .add-student-section h4 {
      margin-bottom: 20px;
      font-weight: 700;
      text-align: center;
    }
    
    .form-control {
      border-radius: 10px;
      border: 2px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.9);
      padding: 12px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      border-color: #fdcb6e;
      box-shadow: 0 0 15px rgba(253, 203, 110, 0.3);
      transform: scale(1.02);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 10px;
      padding: 12px 30px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(214, 48, 49, 0.4);
    }
    
    .floating-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      animation: float 8s infinite ease-in-out;
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    .motivation-banner {
      background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 600;
      margin: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .subject-filter {
      background: rgba(255,255,255,0.9);
      padding: 20px;
      border-radius: 15px;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .grade-input {
      width: 50px;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #ddd;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .system-title {
        font-size: 1.5rem;
      }
      
      .header-section {
        padding: 20px 15px;
      }
      
      .custom-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      .custom-table th,
      .custom-table td {
        min-width: 60px;
        font-size: 0.75rem;
        padding: 8px 4px;
      }
      
      .editable {
        width: 45px;
        padding: 4px;
        font-size: 0.75rem;
      }
      
      .btn-sm {
        font-size: 0.7rem;
        padding: 4px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="floating-particles" id="particles"></div>
  
  <div id="loginOverlay">
    <div id="loginBox">
      <div class="school-logo">
        <i class="fas fa-graduation-cap"></i>
        <div class="school-name">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡</div>
        <div class="school-motto">Ù†Ø­Ùˆ Ø§Ù„ØªÙ…ÙŠØ² ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹</div>
      </div>
      
      <h4 class="mb-4 text-center" style="color: #2c3e50; font-weight: 700;">
        <i class="fas fa-sign-in-alt me-2"></i>
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      </h4>
      
      <div class="mb-3">
        <label class="form-label" style="font-weight: 600; color: #2c3e50;">
          <i class="fas fa-user-tag me-2"></i>
          Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:
        </label>
        <select id="roleSelect" class="form-select">
          <option value="student">Ø·Ø§Ù„Ø¨</option>
          <option value="teacher">Ù…Ø¯Ø±Ù‘Ø³</option>
          <option value="admin">Ø¥Ø¯Ø§Ø±ÙŠ</option>
        </select>
      </div>
      
      <div class="mb-3">
        <label class="form-label" style="font-weight: 600; color: #2c3e50;">
          <i class="fas fa-key me-2"></i>
          Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:
        </label>
        <input type="password" id="loginCode" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²">
      </div>
      
      <button id="loginBtn" class="btn btn-primary w-100">
        <i class="fas fa-sign-in-alt me-2"></i>
        Ø¯Ø®ÙˆÙ„
      </button>
      
      <p id="loginError" class="text-danger mt-3 text-center" style="display:none; font-weight: 600;">
        <i class="fas fa-exclamation-triangle me-2"></i>
        Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­
      </p>
    </div>
  </div>

  <div class="container-fluid" id="mainContent" style="display:none;">
    <div class="main-container">
      <div class="header-section">
        <div class="header-content">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h1 class="system-title">
                <i class="fas fa-school me-3"></i>
                Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡
              </h1>
              <p class="inspiration-quote">
                <i class="fas fa-quote-left me-2"></i>
                "Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¬ÙŠØ¯ Ù‡Ùˆ Ø£Ø³Ø§Ø³ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ØªÙÙˆÙ‚"
                <i class="fas fa-quote-right ms-2"></i>
              </p>
            </div>
            <div>
              <div id="adminControls" style="display:none;">
                <button class="btn btn-success me-2" onclick="exportData()">
                  <i class="fas fa-download me-2"></i>
                  ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData()">
                <button class="btn btn-info me-2" onclick="document.getElementById('importFile').click()">
                  <i class="fas fa-upload me-2"></i>
                  Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
              </div>
              <button id="logoutBtn" class="btn btn-danger">
                <i class="fas fa-sign-out-alt me-2"></i>
                Ø®Ø±ÙˆØ¬
              </button>
            </div>
          </div>
          
          <div class="user-welcome" id="userWelcome">
            <div class="d-flex align-items-center">
              <i class="fas fa-user-circle me-3" style="font-size: 2rem;"></i>
              <div>
                <h5 class="mb-0">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡</h5>
                <p class="mb-0 opacity-75">Ù†Ø³Ø¹Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="motivation-banner" id="motivationBanner" style="display:none;">
        <i class="fas fa-heart me-2"></i>
        "Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„ÙƒØ±Ø§Ù…ØŒ Ø´Ø±Ø§ÙƒØªÙƒÙ… Ù…Ø¹Ù†Ø§ Ù‡ÙŠ Ø³Ø± Ù†Ø¬Ø§Ø­ Ø£Ø¨Ù†Ø§Ø¦ÙƒÙ… ÙˆØªÙÙˆÙ‚Ù‡Ù…"
        <i class="fas fa-handshake ms-2"></i>
      </div>

      <div class="subject-filter" id="subjectFilter" style="display:none;">
        <div class="row align-items-center">
          <div class="col-md-3">
            <label class="form-label fw-bold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
          </div>
          <div class="col-md-9">
            <select id="subjectSelect" class="form-select" onchange="renderTable()">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</option>
              <option value="Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
              <option value="Ø§Ù„Ø¹Ø±Ø¨ÙŠ">Ø§Ù„Ø¹Ø±Ø¨ÙŠ</option>
              <option value="Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ">Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ</option>
              <option value="Ø§Ù„Ø£Ø­ÙŠØ§Ø¡">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
              <option value="Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª">Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</option>
              <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
              <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
              <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
            </select>
          </div>
        </div>
      </div>

      <div class="table-container">
        <table id="dataTable" class="table custom-table">
          <thead>
            <tr id="tableHead"></tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div id="addStudentSection" class="add-student-section" style="display:none;">
        <h4>
          <i class="fas fa-user-plus me-2"></i>
          Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
        </h4>
        <div class="row">
          <div class="col-md-4">
            <input type="text" id="newName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
          </div>
          <div class="col-md-3">
            <input type="text" id="newPhone" class="form-control" placeholder="Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
          </div>
          <div class="col-md-3">
            <input type="text" id="newCode" class="form-control" placeholder="Ø±Ù…Ø² Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù…Ø«Ø§Ù„: STU001)">
          </div>
          <div class="col-md-2">
            <button class="btn btn-success w-100" onclick="addStudent()">
              <i class="fas fa-plus me-1"></i>
              Ø¥Ø¶Ø§ÙØ©
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (Math.random() * 8 + 4) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    createParticles();

    // Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
    const subjects = ['Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ', 'Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ', 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡', 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡'];
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ø¯ÙŠÙ‡ Ø¯Ø±Ø¬Ø§Øª ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯
    const students = [
      {
        id: 1,
        name: 'Ù…ØµØ·ÙÙ‰ ØµÙØ§Ø¡',
        parentPhone: '+9647700001111',
        code: 'STU001',
        grades: {
          'Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©': {month1: 85, month2: 88, midterm: 90, month3: 87, month4: 92, final: 89},
          'Ø§Ù„Ø¹Ø±Ø¨ÙŠ': {month1: 78, month2: 82, midterm: 85, month3: 80, month4: 88, final: 86},
          'Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ': {month1: 92, month2: 89, midterm: 94, month3: 91, month4: 95, final: 93},
          'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡': {month1: 87, month2: 85, midterm: 89, month3: 86, month4: 90, final: 88},
          'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª': {month1: 83, month2: 86, midterm: 88, month3: 85, month4: 89, final: 87},
          'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª': {month1: 95, month2: 92, midterm: 97, month3: 94, month4: 96, final: 95},
          'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡': {month1: 88, month2: 90, midterm: 92, month3: 89, month4: 93, final: 91},
          'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡': {month1: 91, month2: 88, midterm: 93, month3: 90, month4: 94, final: 92}
        }
      },
      {
        id: 2,
        name: 'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
        parentPhone: '+9647700002222',
        code: 'STU002',
        grades: {
          'Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©': {month1: 92, month2: 89, midterm: 94, month3: 91, month4: 95, final: 93},
          'Ø§Ù„Ø¹Ø±Ø¨ÙŠ': {month1: 85, month2: 88, midterm: 90, month3: 87, month4: 92, final: 89},
          'Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ': {month1: 88, month2: 85, midterm: 89, month3: 86, month4: 90, final: 88},
          'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡': {month1: 90, month2: 93, midterm: 95, month3: 92, month4: 96, final: 94},
          'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª': {month1: 87, month2: 84, midterm: 88, month3: 85, month4: 89, final: 87},
          'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª': {month1: 89, month2: 92, midterm: 94, month3: 91, month4: 95, final: 93},
          'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡': {month1: 93, month2: 90, midterm: 95, month3: 92, month4: 96, final: 94},
          'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡': {month1: 86, month2: 89, midterm: 91, month3: 88, month4: 92, final: 90}
        }
      }
    ];
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†
    const teachers = [
      {name: 'Ø£. Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø³Ù†ÙŠ', subject: 'Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', code: 'TEA001'},
      {name: 'Ø£. ÙØ§Ø·Ù…Ø© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ', subject: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ', code: 'TEA002'},
      {name: 'Ø£. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¨ØµØ±ÙŠ', subject: 'Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ', code: 'TEA003'},
      {name: 'Ø£. Ø³Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØµÙ„ÙŠ', subject: 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡', code: 'TEA004'},
      {name: 'Ø£. Ø¹Ù„ÙŠ Ø§Ù„Ù†Ø¬ÙÙŠ', subject: 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª', code: 'TEA005'},
      {name: 'Ø£. Ø­Ø³Ø§Ù… Ø§Ù„Ø²Ø±ÙƒØ§Ù†ÙŠ', subject: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', code: 'TEA006'},
      {name: 'Ø£. Ù†ÙˆØ± Ø§Ù„ÙƒØ±Ø¨Ù„Ø§Ø¦ÙŠ', subject: 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', code: 'TEA007'},
      {name: 'Ø£. Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¨ØºØ¯Ø§Ø¯ÙŠ', subject: 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡', code: 'TEA008'}
    ];
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ†
    const admins = [
      {name: 'Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ù„ÙŠ', code: 'ADM001'},
      {name: 'Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£ÙƒØ±Ù…', code: 'ADM002'}
    ];
    
    let currentRole = '', currentCode = '';
    
    document.getElementById('loginBtn').onclick = () => {
      const role = document.getElementById('roleSelect').value;
      const code = document.getElementById('loginCode').value.trim();
      let valid = false;
      
      if (role === 'student') valid = students.some(s => s.code === code);
      if (role === 'teacher') valid = teachers.some(t => t.code === code);
      if (role === 'admin') valid = admins.some(a => a.code === code);
      
      if (!valid) {
        document.getElementById('loginError').style.display = 'block';
        return;
      }
      
      currentRole = role;
      currentCode = code;
      document.getElementById('loginOverlay').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      updateWelcomeMessage();
      renderTable();
    };
    
    document.getElementById('logoutBtn').onclick = () => location.reload();
    
    function updateWelcomeMessage() {
      const welcomeDiv = document.getElementById('userWelcome');
      const adminControls = document.getElementById('adminControls');
      let userName = '';
      let userIcon = '';
      
      if (currentRole === 'student') {
        const student = students.find(s => s.code === currentCode);
        userName = student.name;
        userIcon = 'fas fa-user-graduate';
        adminControls.style.display = 'none';
      } else if (currentRole === 'teacher') {
        const teacher = teachers.find(t => t.code === currentCode);
        userName = teacher.name;
        userIcon = 'fas fa-chalkboard-teacher';
        adminControls.style.display = 'none';
      } else if (currentRole === 'admin') {
        const admin = admins.find(a => a.code === currentCode);
        userName = admin.name;
        userIcon = 'fas fa-user-tie';
        adminControls.style.display = 'block';
      }
      
      welcomeDiv.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="${userIcon} me-3" style="font-size: 2rem;"></i>
          <div>
            <h5 class="mb-0">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName}</h5>
            <p class="mb-0 opacity-75">Ù†Ø³Ø¹Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
          </div>
        </div>
      `;
    }
    
    function renderTable() {
      const head = [];
      const body = [];
      const showAdd = document.getElementById('addStudentSection');
      const motivationBanner = document.getElementById('motivationBanner');
      const subjectFilter = document.getElementById('subjectFilter');
      const selectedSubject = document.getElementById('subjectSelect')?.value || '';
      
      if (currentRole === 'admin') {
        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø£Ùˆ Ù…Ø§Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©
        subjectFilter.style.display = 'block';
        showAdd.style.display = 'block';
        motivationBanner.style.display = 'none';
        
        if (selectedSubject) {
          // Ø¹Ø±Ø¶ Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©
          head.push('Ø§Ù„Ø±Ù‚Ù…', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…Ø§Ø¯Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ù†ØµÙ Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹', 'Ø¢Ø®Ø± Ø§Ù„Ø³Ù†Ø©', 'Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª');
          
          students.forEach(s => {
            const grades = s.grades[selectedSubject];
            body.push([
              s.id,
              s.name,
              selectedSubject,
              `<input type="number" value="${grades.month1}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'month1', this.value)" min="0" max="100">`,
              `<input type="number" value="${grades.month2}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'month2', this.value)" min="0" max="100">`,
              `<input type="number" value="${grades.midterm}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'midterm', this.value)" min="0" max="100">`,
              `<input type="number" value="${grades.month3}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'month3', this.value)" min="0" max="100">`,
              `<input type="number" value="${grades.month4}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'month4', this.value)" min="0" max="100">`,
              `<input type="number" value="${grades.final}" class="editable" onchange="updateGrade(${s.id}, '${selectedSubject}', 'final', this.value)" min="0" max="100">`,
              `<input type="text" value="${s.parentPhone}" class="editable" onchange="updatePhone(${s.id}, this.value)" style="width: 120px;">`,
              `<button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.id})">
                <i class="fas fa-trash"></i>
              </button>`
            ]);
          });
        } else {
          // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ - Ù…Ù„Ø®Øµ
          head.push('Ø§Ù„Ø±Ù‚Ù…', 'Ø§Ù„Ø§Ø³Ù…', 'Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', 'Ø±Ù…Ø² Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª');
          
          students.forEach(s => {
            body.push([
              s.id,
              s.name,
              `<input type="text" value="${s.parentPhone}" class="editable" onchange="updatePhone(${s.id}, this.value)" style="width: 120px;">`,
              s.code,
              `<button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.id})">
                <i class="fas fa-trash"></i>
              </button>`
            ]);
          });
        }
        
      } else if (currentRole === 'teacher') {
        // Ø§Ù„Ù…Ø¯Ø±Ø³ ÙŠØ±Ù‰ Ø·Ù„Ø§Ø¨ Ù…Ø§Ø¯ØªÙ‡ ÙÙ‚Ø·
        const teacher = teachers.find(t => t.code === currentCode);
        subjectFilter.style.display = 'none';
        showAdd.style.display = 'none';
        motivationBanner.style.display = 'none';
        
        head.push('Ø§Ù„Ø±Ù‚Ù…', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…Ø§Ø¯Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ù†ØµÙ Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹', 'Ø¢Ø®Ø± Ø§Ù„Ø³Ù†Ø©', 'Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±');
        
        students.forEach(s => {
          const grades = s.grades[teacher.subject];
          body.push([
            s.id,
            s.name,
            teacher.subject,
            `<input type="number" value="${grades.month1}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'month1', this.value)" min="0" max="100">`,
            `<input type="number" value="${grades.month2}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'month2', this.value)" min="0" max="100">`,
            `<input type="number" value="${grades.midterm}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'midterm', this.value)" min="0" max="100">`,
            `<input type="number" value="${grades.month3}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'month3', this.value)" min="0" max="100">`,
            `<input type="number" value="${grades.month4}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'month4', this.value)" min="0" max="100">`,
            `<input type="number" value="${grades.final}" class="editable" onchange="updateGrade(${s.id}, '${teacher.subject}', 'final', this.value)" min="0" max="100">`,
            s.parentPhone
          ]);
        });
        
      } else if (currentRole === 'student') {
        // Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ±Ù‰ Ø¯Ø±Ø¬Ø§ØªÙ‡ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯
        const student = students.find(s => s.code === currentCode);
        subjectFilter.style.display = 'none';
        showAdd.style.display = 'none';
        motivationBanner.style.display = 'block';
        
        head.push('Ø§Ù„Ù…Ø§Ø¯Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ù†ØµÙ Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹', 'Ø¢Ø®Ø± Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ù…Ø¹Ø¯Ù„');
        
        subjects.forEach(subject => {
          const grades = student.grades[subject];
          const average = ((grades.month1 + grades.month2 + grades.midterm + grades.month3 + grades.month4 + grades.final) / 6).toFixed(1);
          
          body.push([
            subject,
            grades.month1,
            grades.month2,
            grades.midterm,
            grades.month3,
            grades.month4,
            grades.final,
            `<strong style="color: ${average >= 80 ? '#00b894' : average >= 60 ? '#fdcb6e' : '#e17055'}">${average}</strong>`
          ]);
        });
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const thead = document.getElementById('tableHead');
      thead.innerHTML = '';
      head.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        thead.appendChild(th);
      });
      
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      body.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.innerHTML = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }
    
    function addStudent() {
      const name = document.getElementById('newName').value.trim();
      const phone = document.getElementById('newPhone').value.trim();
      const code = document.getElementById('newCode').value.trim();
      
      if (!name || !phone || !code) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ù…Ø²
      if (students.some(s => s.code === code)) {
        alert('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø¢Ø®Ø±');
        return;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø±Ø¬Ø§Øª ÙØ§Ø±ØºØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯
      const newGrades = {};
      subjects.forEach(subject => {
        newGrades[subject] = {
          month1: 0,
          month2: 0,
          midterm: 0,
          month3: 0,
          month4: 0,
          final: 0
        };
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      students.push({
        id: Math.max(...students.map(s => s.id)) + 1,
        name,
        parentPhone: phone,
        code,
        grades: newGrades
      });
      
      renderTable();
      
      // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById('newName').value = '';
      document.getElementById('newPhone').value = '';
      document.getElementById('newCode').value = '';
      
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰\nÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø²: ' + code);
    }
    
    function updateGrade(studentId, subject, gradeType, newGrade) {
      const grade = parseInt(newGrade);
      if (isNaN(grade) || grade < 0 || grade > 100) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø© ØµØ­ÙŠØ­Ø© Ø¨ÙŠÙ† 0 Ùˆ 100');
        renderTable();
        return;
      }
      
      const student = students.find(s => s.id === studentId);
      if (student && student.grades[subject]) {
        student.grades[subject][gradeType] = grade;
      }
    }
    
    function updatePhone(id, newPhone) {
      const student = students.find(s => s.id === id);
      if (student) {
        student.parentPhone = newPhone;
      }
    }
    
    function deleteStudent(id) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¯Ø±Ø¬Ø§ØªÙ‡ ÙÙŠ ÙƒØ§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯!')) {
        const index = students.findIndex(s => s.id === id);
        if (index > -1) {
          students.splice(index, 1);
          renderTable();
          alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
      }
    }
    
    // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function exportData() {
      const data = {
        students: students,
        teachers: teachers,
        admins: admins,
        exportDate: new Date().toISOString(),
        version: "1.0"
      };
      
      const jsonData = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonData], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `school_data_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸ“');
    }
    
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function importData() {
      const file = document.getElementById('importFile').files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (data.students && data.teachers && data.admins) {
            // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            students.length = 0;
            students.push(...data.students);
            
            if (data.teachers.length > 0) {
              teachers.length = 0;
              teachers.push(...data.teachers);
            }
            
            if (data.admins.length > 0) {
              admins.length = 0;
              admins.push(...data.admins);
            }
            
            renderTable();
            alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸ“‚\nØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ' + (data.exportDate ? new Date(data.exportDate).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'));
          } else {
            alert('Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­!');
          }
        } catch (error) {
          alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù! ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ Ù…Ù„Ù ØµØ­ÙŠØ­.');
        }
      };
      reader.readAsText(file);
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© input
      document.getElementById('importFile').value = '';
    }
  </script>
</body>
</html>